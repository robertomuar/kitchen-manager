import{s as M,y as N,j as k,c as P,w as _,a as n,b as t,d as C,h as L,g as r,i as g,l as q,f as S,o as a,t as d,k as m,F as v,m as y,z as f,n as z,p as B}from"./app-DgjmkXFC.js";import{_ as H}from"./AuthenticatedLayout-DwczY6YG.js";import{_ as b}from"./InputLabel-C4ahWGpn.js";import{P as O}from"./PrimaryButton-C1rQRLSW.js";import"./ApplicationLogo-D-eAWrVV.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"py-8"},G={class:"mx-auto max-w-7xl sm:px-6 lg:px-8 space-y-6"},J={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},K={key:0,class:"rounded-2xl border border-emerald-500/60 bg-emerald-500/10 px-4 py-3 text-sm text-emerald-200 shadow-sm shadow-emerald-500/30"},Q={class:"km-card p-4 sm:p-5"},W={class:"flex flex-col gap-4 md:flex-row md:items-end md:justify-between"},X={class:"w-full md:w-1/3"},Y=["value"],Z={class:"w-full md:w-1/3"},tt=["value"],et={class:"w-full md:w-1/3"},st={class:"mt-4 flex flex-col gap-4 md:flex-row md:items-end md:justify-between"},ot={class:"flex gap-3 w-full md:w-1/2"},lt={class:"flex-1"},at={class:"flex-1"},rt={class:"flex gap-2 justify-end w-full md:w-1/2"},dt={class:"km-card overflow-hidden"},it={key:0,class:"p-6 text-center text-slate-400 text-sm"},nt={key:1,class:"overflow-x-auto"},ut={class:"km-table"},ct={class:"whitespace-nowrap text-sm font-medium text-slate-50"},pt={class:"whitespace-nowrap text-sm text-slate-200"},xt={class:"whitespace-nowrap text-sm text-slate-300"},mt={class:"whitespace-nowrap text-sm text-slate-300"},ft={class:"whitespace-nowrap text-sm"},bt={class:"flex flex-wrap gap-1"},_t={key:0,class:"km-badge-red"},gt={key:1,class:"km-badge-amber"},vt={class:"whitespace-nowrap text-sm text-right"},yt={class:"inline-flex gap-2"},ht=["onClick"],wt={class:"km-card overflow-hidden"},kt={class:"px-6 py-4 border-b border-slate-800/80 flex items-center justify-between"},Ct={class:"flex items-center gap-3"},St={class:"text-xs text-slate-400"},jt={key:0,class:"p-6 text-sm text-slate-400"},Vt={key:1,class:"overflow-x-auto"},Dt={class:"km-table"},Ft={class:"whitespace-nowrap text-sm font-medium text-slate-50"},Tt={class:"whitespace-nowrap text-sm text-slate-300"},qt={class:"whitespace-nowrap text-sm text-slate-200"},Bt={class:"whitespace-nowrap text-sm text-slate-200"},At={class:"whitespace-nowrap text-sm text-slate-200"},Lt={__name:"Index",props:{stockItems:{type:Array,default:()=>[]},products:{type:Array,default:()=>[]},locations:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({product_id:"",location_id:"",status:"",sort:"expires_at",direction:"asc"})}},setup(x){const c=x,h=M(),l=N({product_id:c.filters.product_id??"",location_id:c.filters.location_id??"",status:c.filters.status??"",sort:c.filters.sort??"expires_at",direction:c.filters.direction??"asc"}),A=k(()=>!!(h.props.flash&&h.props.flash.success)),E=k(()=>{var o;return((o=h.props.flash)==null?void 0:o.success)??""}),w=k(()=>c.stockItems.filter(o=>o.is_below_minimum===!0)),j=()=>{B.get(route("stock.index"),{product_id:l.value.product_id||void 0,location_id:l.value.location_id||void 0,status:l.value.status||void 0,sort:l.value.sort,direction:l.value.direction},{preserveState:!0,preserveScroll:!0,replace:!0})},I=()=>{l.value={product_id:"",location_id:"",status:"",sort:"expires_at",direction:"asc"},j()},U=o=>{var s;confirm(`¿Seguro que quieres eliminar el stock de "${((s=o.product)==null?void 0:s.name)??"producto"}"?`)&&B.delete(route("stock.destroy",o.id),{preserveScroll:!0})},p=o=>{if(!o.expires_at)return null;const s=new Date,e=new Date(o.expires_at);s.setHours(0,0,0,0),e.setHours(0,0,0,0);const u=e.getTime()-s.getTime(),i=Math.round(u/(1e3*60*60*24));return i<0?{type:"expired",days:i}:i===0?{type:"today",days:0}:i<=2?{type:"urgent",days:i}:i<=7?{type:"soon",days:i}:null},V=o=>o?o.type==="expired"?"Caducado":o.type==="today"?"Caduca hoy":o.type==="urgent"?`Caduca en ${o.days} día${o.days===1?"":"s"}`:o.type==="soon"?`Caduca en ${o.days} días`:"":"",$=()=>{const o={product_id:l.value.product_id||void 0,location_id:l.value.location_id||void 0},s=route("stock.replenishment.export",o);window.location.href=s};return(o,s)=>(a(),P(H,null,{default:_(()=>[n(C(L),{title:"Stock"}),t("div",R,[t("div",G,[t("div",J,[s[6]||(s[6]=t("div",null,[t("h1",{class:"text-2xl font-semibold text-slate-50"}," Stock de mi cocina "),t("p",{class:"mt-1 text-sm text-slate-400"}," Vista general del stock: cantidades, ubicaciones y caducidades de tus productos. ")],-1)),n(C(q),{href:o.route("stock.create"),class:"inline-flex items-center rounded-xl border border-indigo-500/70 bg-indigo-500/15 px-4 py-2 text-sm font-medium text-indigo-100 shadow-sm shadow-indigo-500/30 hover:bg-indigo-500/25"},{default:_(()=>[...s[5]||(s[5]=[S(" Nuevo registro de stock ",-1)])]),_:1},8,["href"])]),A.value?(a(),r("div",K,d(E.value),1)):g("",!0),t("div",Q,[t("div",W,[t("div",X,[n(b,{for:"filter_product",value:"Filtrar por producto",class:"text-slate-200"}),m(t("select",{id:"filter_product","onUpdate:modelValue":s[0]||(s[0]=e=>l.value.product_id=e),class:"mt-1 block w-full rounded-xl border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"},[s[7]||(s[7]=t("option",{value:"",class:"bg-slate-900 text-slate-100"}," Todos los productos ",-1)),(a(!0),r(v,null,y(x.products,e=>(a(),r("option",{key:e.id,value:e.id,class:"bg-slate-900 text-slate-100"},d(e.name),9,Y))),128))],512),[[f,l.value.product_id]])]),t("div",Z,[n(b,{for:"filter_location",value:"Filtrar por ubicación",class:"text-slate-200"}),m(t("select",{id:"filter_location","onUpdate:modelValue":s[1]||(s[1]=e=>l.value.location_id=e),class:"mt-1 block w-full rounded-xl border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"},[s[8]||(s[8]=t("option",{value:"",class:"bg-slate-900 text-slate-100"}," Todas las ubicaciones ",-1)),(a(!0),r(v,null,y(x.locations,e=>(a(),r("option",{key:e.id,value:e.id,class:"bg-slate-900 text-slate-100"},d(e.name),9,tt))),128))],512),[[f,l.value.location_id]])]),t("div",et,[n(b,{for:"filter_status",value:"Estado",class:"text-slate-200"}),m(t("select",{id:"filter_status","onUpdate:modelValue":s[2]||(s[2]=e=>l.value.status=e),class:"mt-1 block w-full rounded-xl border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"},[...s[9]||(s[9]=[t("option",{value:"",class:"bg-slate-900 text-slate-100"}," Todos ",-1),t("option",{value:"low",class:"bg-slate-900 text-slate-100"}," Solo bajo mínimo ",-1),t("option",{value:"normal",class:"bg-slate-900 text-slate-100"}," Solo normales ",-1)])],512),[[f,l.value.status]])])]),t("div",st,[t("div",ot,[t("div",lt,[n(b,{for:"sort",value:"Ordenar por",class:"text-slate-200"}),m(t("select",{id:"sort","onUpdate:modelValue":s[3]||(s[3]=e=>l.value.sort=e),class:"mt-1 block w-full rounded-xl border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"},[...s[10]||(s[10]=[t("option",{value:"expires_at",class:"bg-slate-900 text-slate-100"}," Fecha de caducidad ",-1),t("option",{value:"quantity",class:"bg-slate-900 text-slate-100"}," Cantidad ",-1)])],512),[[f,l.value.sort]])]),t("div",at,[n(b,{for:"direction",value:"Dirección",class:"text-slate-200"}),m(t("select",{id:"direction","onUpdate:modelValue":s[4]||(s[4]=e=>l.value.direction=e),class:"mt-1 block w-full rounded-xl border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"},[...s[11]||(s[11]=[t("option",{value:"asc",class:"bg-slate-900 text-slate-100"}," Ascendente ",-1),t("option",{value:"desc",class:"bg-slate-900 text-slate-100"}," Descendente ",-1)])],512),[[f,l.value.direction]])])]),t("div",rt,[t("button",{type:"button",class:"text-sm text-slate-400 hover:text-slate-100",onClick:I}," Limpiar "),n(O,{type:"button",onClick:j},{default:_(()=>[...s[12]||(s[12]=[S(" Aplicar filtros ",-1)])]),_:1})])])]),t("div",dt,[x.stockItems.length?(a(),r("div",nt,[t("table",ut,[s[14]||(s[14]=t("thead",null,[t("tr",null,[t("th",null,"Producto"),t("th",null,"Cantidad"),t("th",null,"Ubicación"),t("th",null,"Caducidad"),t("th",null,"Estado"),t("th",{class:"text-right"},"Acciones")])],-1)),t("tbody",null,[(a(!0),r(v,null,y(x.stockItems,e=>{var u,i,D,F,T;return a(),r("tr",{key:e.id},[t("td",ct,d(((u=e.product)==null?void 0:u.name)??"—"),1),t("td",pt,d(e.quantity)+" "+d(e.unit),1),t("td",xt,d(((i=e.location)==null?void 0:i.name)??"Sin ubicación"),1),t("td",mt,d(e.expires_at?e.expires_at.substring(0,10):"—"),1),t("td",ft,[t("div",bt,[e.is_below_minimum?(a(),r("span",_t," Bajo mínimo ")):g("",!0),e.is_open?(a(),r("span",gt," Abierto ")):g("",!0),p(e)&&V(p(e))?(a(),r("span",{key:2,class:z(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium border",((D=p(e))==null?void 0:D.type)==="expired"||((F=p(e))==null?void 0:F.type)==="urgent"||((T=p(e))==null?void 0:T.type)==="today"?"bg-rose-500/10 text-rose-200 border-rose-500/60":"bg-amber-500/10 text-amber-100 border-amber-500/60"])},d(V(p(e))),3)):g("",!0)])]),t("td",vt,[t("div",yt,[n(C(q),{href:o.route("stock.edit",e.id),class:"text-xs px-3 py-1 rounded-lg border border-slate-600/80 text-slate-100 hover:bg-slate-800/80"},{default:_(()=>[...s[13]||(s[13]=[S(" Editar ",-1)])]),_:1},8,["href"]),t("button",{type:"button",class:"text-xs px-3 py-1 rounded-lg border border-rose-500/70 text-rose-300 hover:bg-rose-500/15",onClick:Et=>U(e)}," Borrar ",8,ht)])])])}),128))])])])):(a(),r("div",it," Todavía no tienes stock registrado (o los filtros no devuelven resultados). "))]),t("div",wt,[t("div",kt,[s[15]||(s[15]=t("h2",{class:"text-sm font-semibold text-slate-100"}," Lista de reposición (bajo mínimo) ",-1)),t("div",Ct,[t("span",St," Total: "+d(w.value.length),1),t("button",{type:"button",onClick:$,class:"inline-flex items-center rounded-xl border border-emerald-500/70 bg-emerald-500/10 px-3 py-1.5 text-xs font-medium text-emerald-100 shadow-sm shadow-emerald-500/30 hover:bg-emerald-500/20"}," Exportar lista (CSV) ")])]),w.value.length?(a(),r("div",Vt,[t("table",Dt,[s[16]||(s[16]=t("thead",null,[t("tr",null,[t("th",null,"Producto"),t("th",null,"Ubicación"),t("th",null,"Cantidad actual"),t("th",null,"Mínimo"),t("th",null,"Falta aprox.")])],-1)),t("tbody",null,[(a(!0),r(v,null,y(w.value,e=>{var u,i;return a(),r("tr",{key:e.id},[t("td",Ft,d(((u=e.product)==null?void 0:u.name)??"—"),1),t("td",Tt,d(((i=e.location)==null?void 0:i.name)??"Sin ubicación"),1),t("td",qt,d(e.quantity)+" "+d(e.unit),1),t("td",Bt,d(e.min_quantity),1),t("td",At,d(Math.max(0,(e.min_quantity??0)-(e.quantity??0)).toFixed(2)),1)])}),128))])])])):(a(),r("div",jt," De momento no hay ningún producto por debajo del mínimo. ✅ "))])])])]),_:1}))}};export{Lt as default};
